ComponentDefinitions:
  cmp_FocusableInput:
    DefinitionType: CanvasComponent
    Description: |-
      Input control with focus capability using the FocusTrigger pattern.

      USAGE:
      1. Bind FocusTrigger to a context variable
      2. Change the variable to "SetFocus" + unique value to trigger focus

      Example:
        Button.OnSelect = UpdateContext({ ctxFocus: "SetFocus" & Text(Rand()) });
        cmp_FocusableInput.FocusTrigger = ctxFocus

    CustomProperties:
      # ==================================================================
      # INPUT PROPERTIES - Styling & Configuration
      # ==================================================================
      BorderColor:
        PropertyKind: Input
        DisplayName: Border Color
        Description: Border color of the input
        DataType: Color
        Default: =RGBA(0, 120, 212, 1)

      BorderRadius:
        PropertyKind: Input
        DisplayName: Border Radius
        Description: Corner radius of the input
        DataType: Number
        Default: =4

      FillColor:
        PropertyKind: Input
        DisplayName: Fill Color
        Description: Background fill color
        DataType: Color
        Default: =Color.White

      Font:
        PropertyKind: Input
        DisplayName: Font
        Description: Font family
        DataType: Text
        Default: ="Segoe UI"

      FontSize:
        PropertyKind: Input
        DisplayName: Font Size
        Description: Font size for input text
        DataType: Number
        Default: =14

      HintText:
        PropertyKind: Input
        DisplayName: Hint Text
        Description: Placeholder text shown when input is empty
        DataType: Text
        Default: ="Enter text..."

      Label:
        PropertyKind: Input
        DisplayName: Label
        Description: Label text above the input
        DataType: Text
        Default: ="Field Name"

      LabelColor:
        PropertyKind: Input
        DisplayName: Label Color
        Description: Color of the label text
        DataType: Color
        Default: =RGBA(50, 50, 50, 1)

      Required:
        PropertyKind: Input
        DisplayName: Required
        Description: Whether the field is required
        DataType: Boolean
        Default: =false

      RequiredBorderColor:
        PropertyKind: Input
        DisplayName: Required Border Color
        Description: Border color when required and empty
        DataType: Color
        Default: =RGBA(255, 0, 0, 1)

      TextValue:
        PropertyKind: Input
        DisplayName: Text Value
        Description: Default text value for the input
        DataType: Text
        Default: =""

      # ==================================================================
      # FOCUS TRIGGER - The key property for SetFocus behavior
      # ==================================================================
      FocusTrigger:
        PropertyKind: Input
        DisplayName: Focus Trigger
        Description: |-
          Change this value to trigger focus on the input control.
          Pattern: "SetFocus" + unique value (use Text(Rand()) to ensure uniqueness)

          Example from app:
            UpdateContext({ ctxFocus: "SetFocus" & Text(Rand()) });
            cmp_FocusableInput.FocusTrigger = ctxFocus
        RaiseOnReset: true
        DataType: Text
        Default: =""

      ResetTrigger:
        PropertyKind: Input
        DisplayName: Reset Trigger
        Description: Change this value to reset the input to default
        RaiseOnReset: true
        DataType: Boolean
        Default: =false

      # ==================================================================
      # OUTPUT PROPERTIES - Data flowing from component to app
      # ==================================================================
      Value:
        PropertyKind: Output
        DisplayName: Value
        Description: Current text value of the input
        DataType: Text

      IsValid:
        PropertyKind: Output
        DisplayName: IsValid
        Description: Whether the input passes validation (not empty if required)
        DataType: Boolean

      # ==================================================================
      # EVENT PROPERTIES - App defines the logic, component calls it
      # ==================================================================
      OnChange:
        PropertyKind: Event
        DisplayName: OnChange
        Description: |-
          Triggered when the input value changes.
          Define your logic in the app, component will call it.

          Example:
            cmp_FocusableInput.OnChange =
              Notify("Value: " & cmp_FocusableInput.Value)
        ReturnType: Text
        Default: ="Text"

      OnFocus:
        PropertyKind: Event
        DisplayName: OnFocus
        Description: Triggered when the input receives focus
        ReturnType: None
        Default: =false

    # ==================================================================
    # COMPONENT-LEVEL PROPERTIES
    # ==================================================================
    Properties:
      Height: =80
      Width: =320

      # Output property implementations
      Value: =txt_Input.Text
      IsValid: |-
        =If(
            cmp_FocusableInput.Required,
            !IsBlank(txt_Input.Text),
            true
        )

    # ==================================================================
    # CHILD CONTROLS
    # ==================================================================
    Children:
      # Label control
      - lbl_FieldName:
          Control: Label@2.5.1
          Properties:
            Text: =cmp_FocusableInput.Label
            Color: =cmp_FocusableInput.LabelColor
            Font: =cmp_FocusableInput.Font
            FontWeight: =FontWeight.Semibold
            Size: =cmp_FocusableInput.FontSize - 2
            Height: =28
            Width: =Parent.Width
            X: =0
            Y: =0
            PaddingLeft: =4
            VerticalAlign: =VerticalAlign.Bottom

      # Container for the input (provides border styling)
      - ctr_InputContainer:
          Control: GroupContainer@1.3.0
          Variant: ManualLayout
          Properties:
            # Dynamic border color based on required/validation state
            BorderColor: |-
              =If(
                  cmp_FocusableInput.Required && IsBlank(txt_Input.Text),
                  cmp_FocusableInput.RequiredBorderColor,
                  cmp_FocusableInput.BorderColor
              )
            BorderThickness: =2
            Fill: =cmp_FocusableInput.FillColor
            Height: =Parent.Height - lbl_FieldName.Height - 4
            Width: =Parent.Width
            X: =0
            Y: =lbl_FieldName.Height + 2
            RadiusBottomLeft: =cmp_FocusableInput.BorderRadius
            RadiusBottomRight: =cmp_FocusableInput.BorderRadius
            RadiusTopLeft: =cmp_FocusableInput.BorderRadius
            RadiusTopRight: =cmp_FocusableInput.BorderRadius

          Children:
            # The actual text input control
            - txt_Input:
                Control: Classic/TextInput@2.3.2
                Properties:
                  Default: =cmp_FocusableInput.TextValue
                  HintText: =cmp_FocusableInput.HintText
                  Font: =cmp_FocusableInput.Font
                  Size: =cmp_FocusableInput.FontSize
                  Color: =RGBA(0, 0, 0, 1)
                  Fill: =Color.Transparent
                  BorderStyle: =BorderStyle.None
                  BorderThickness: =0
                  Height: =Parent.Height
                  Width: =Parent.Width
                  X: =0
                  Y: =0
                  PaddingLeft: =10
                  PaddingRight: =10

                  # ==================================================
                  # KEY BEHAVIORS
                  # ==================================================

                  # Reset behavior - triggered by ResetTrigger changes
                  Reset: =cmp_FocusableInput.ResetTrigger

                  # OnChange event - call the component's event property
                  OnChange: =cmp_FocusableInput.OnChange()

                  # OnSelect event - call the OnFocus event property
                  OnSelect: =cmp_FocusableInput.OnFocus()

                  # ==================================================
                  # FOCUS TRIGGER LOGIC - The magic happens here!
                  # ==================================================
                  # This is the workaround for SetFocus limitation
                  # We watch for changes to FocusTrigger property
                  # When it starts with "SetFocus", we call SetFocus on ourselves
                  # ==================================================
                  OnVisible: |-
                    =If(
                        StartsWith(
                            cmp_FocusableInput.FocusTrigger,
                            "SetFocus"
                        ),
                        SetFocus(Self)
                    )
